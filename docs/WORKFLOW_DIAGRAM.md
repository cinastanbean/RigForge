# RigForge ä¼šè¯åˆ°æ¨èç”Ÿæˆå·¥ä½œæµè¯¦è§£

## ä¸€ã€æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              ç”¨æˆ·è¯·æ±‚å…¥å£                                     â”‚
â”‚                           POST /api/chat                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            ChatService (service.py)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚  â”‚ ä¼šè¯ç®¡ç†     â”‚  â”‚ çŠ¶æ€æŒä¹…åŒ–   â”‚  â”‚ æŒ‡æ ‡ç»Ÿè®¡    â”‚                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          RigForgeGraph (graph.py)                            â”‚
â”‚                        LangGraph çŠ¶æ€ç¼–æ’å¼•æ“                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äºŒã€èŠ‚ç‚¹å…³ç³»ä¸è·³è½¬æ¡ä»¶

### 2.1 çŠ¶æ€æµè½¬æ€»è§ˆ

```mermaid
flowchart TB
    START([ç”¨æˆ·è¾“å…¥]) --> COLLECT[collect_requirements<br/>éœ€æ±‚æ”¶é›†èŠ‚ç‚¹]
    
    COLLECT -->|route=ask_more| FOLLOW_UP[generate_follow_up<br/>è¿½é—®ç”ŸæˆèŠ‚ç‚¹]
    COLLECT -->|route=recommend| RECOMMEND[recommend_build<br/>æ¨èç”ŸæˆèŠ‚ç‚¹]
    
    FOLLOW_UP --> COMPOSE[compose_reply<br/>å›å¤ç»„è£…èŠ‚ç‚¹]
    
    RECOMMEND --> VALIDATE[validate_build<br/>å…¼å®¹æ€§éªŒè¯èŠ‚ç‚¹]
    VALIDATE --> COMPOSE
    
    COMPOSE --> END([è¿”å›ç”¨æˆ·])
```

### 2.2 èŠ‚ç‚¹è¿æ¥å…³ç³»è¡¨

| èµ·ç‚¹ | ç»ˆç‚¹ | è¿æ¥ç±»å‹ | è·³è½¬æ¡ä»¶ |
|------|------|----------|----------|
| START | collect_requirements | å›ºå®šè¾¹ | æ¯è½®å¯¹è¯å…¥å£ |
| collect_requirements | generate_follow_up | æ¡ä»¶è¾¹ | `state["route"] == "ask_more"` |
| collect_requirements | recommend_build | æ¡ä»¶è¾¹ | `state["route"] == "recommend"` |
| generate_follow_up | compose_reply | å›ºå®šè¾¹ | æ— æ¡ä»¶ |
| recommend_build | validate_build | å›ºå®šè¾¹ | æ— æ¡ä»¶ |
| validate_build | compose_reply | å›ºå®šè¾¹ | æ— æ¡ä»¶ |
| compose_reply | END | æ¡ä»¶è¾¹ | `state["response_text"]` å­˜åœ¨ |

### 2.3 è¯¦ç»†è·³è½¬æ¡ä»¶è¯´æ˜

#### æ¡ä»¶è¾¹ 1ï¼šcollect_requirements â†’ generate_follow_up / recommend_build

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      collect_requirements è·¯ç”±å†³ç­–                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   è·¯ç”±å‡½æ•°: route_after_collection(state) â†’ state["route"]                  â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                     è·¯ç”±å†³ç­–æµç¨‹                                     â”‚   â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   1. LLM æ¨¡å¼:                                                      â”‚   â”‚
â”‚   â”‚      llm_based_route = "recommend" if not should_continue else "ask_more" â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   2. è§„åˆ™æ¨¡å¼:                                                       â”‚   â”‚
â”‚   â”‚      rule_based_route = _rule_based_route_decision(merged, user_input) â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   3. æœ€ç»ˆè·¯ç”±:                                                       â”‚   â”‚
â”‚   â”‚      route = llm_based_route  # LLM åˆ¤æ–­ä¼˜å…ˆ                        â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚   â”‚   route = "ask_more"  â”‚         â”‚  route = "recommend"  â”‚              â”‚
â”‚   â”‚                       â”‚         â”‚                       â”‚              â”‚
â”‚   â”‚   è·³è½¬ â†’ generate_follow_up â”‚   â”‚   è·³è½¬ â†’ recommend_build â”‚            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ask_more åˆ†æ”¯è§¦å‘æ¡ä»¶ï¼ˆä»»ä¸€æ»¡è¶³ï¼‰ï¼š**
- LLM è¿”å› `should_continue = true`
- ç¼ºå°‘å…³é”®ä¿¡æ¯ï¼ˆé¢„ç®—ã€ç”¨é€”ã€åˆ†è¾¨ç‡ï¼‰
- ç”¨æˆ·æ²¡æœ‰æ˜ç¡®è¡¨ç¤ºç»“æŸ

**recommend åˆ†æ”¯è§¦å‘æ¡ä»¶ï¼ˆä»»ä¸€æ»¡è¶³ï¼‰ï¼š**
- LLM è¿”å› `should_continue = false`
- ç”¨æˆ·è¯´"ä¸ç”¨äº†"ã€"å¤Ÿäº†"ã€"å¼€å§‹æ¨è"ã€"éšä¾¿"
- å·²æ”¶é›†é¢„ç®—ã€ç”¨é€”ã€åˆ†è¾¨ç‡ä¸‰ä¸ªæ ¸å¿ƒä¿¡æ¯
- å¯¹è¯è½®æ•°è¶…è¿‡é™åˆ¶ï¼ˆé»˜è®¤ 10 è½®ï¼‰

#### æ¡ä»¶è¾¹ 2ï¼šcompose_reply â†’ END

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        compose_reply ç»“æŸæ¡ä»¶                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   è·¯ç”±å‡½æ•°: route_after_reply(state)                                        â”‚
â”‚                                                                             â”‚
â”‚   if state.get("response_text"):                                            â”‚
â”‚       return "end"      # æ­£å¸¸ç»“æŸï¼Œæœ‰å›å¤å†…å®¹                               â”‚
â”‚   return "continue"     # å¼‚å¸¸æƒ…å†µï¼Œæ— å›å¤å†…å®¹ï¼ˆä¹Ÿåº”è¯¥ç»“æŸï¼‰                  â”‚
â”‚                                                                             â”‚
â”‚   æ³¨æ„ï¼šä¸¤ä¸ªåˆ†æ”¯éƒ½æŒ‡å‘ ENDï¼ŒåŒºåˆ«ä»…åœ¨äºæ—¥å¿—è®°å½•                               â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.4 çŠ¶æ€åœ¨å„èŠ‚ç‚¹é—´çš„ä¼ é€’

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           çŠ¶æ€ä¼ é€’å›¾                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                    â”‚
â”‚  â”‚ collect_requirements â”‚                                                    â”‚
â”‚  â”‚                     â”‚                                                    â”‚
â”‚  â”‚ è¾“å‡º:               â”‚                                                    â”‚
â”‚  â”‚  - requirements â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  - route â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”           â”‚
â”‚  â”‚  - response_text â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”¼â”€â”€â”        â”‚
â”‚  â”‚  - follow_up_questions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚  â”‚  â”‚  â”‚     â”‚
â”‚           â”‚                                                 â”‚  â”‚  â”‚  â”‚     â”‚
â”‚           â–¼                                                 â”‚  â”‚  â”‚  â”‚     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚  â”‚  â”‚  â”‚     â”‚
â”‚  â”‚ generate_follow_up  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚     â”‚
â”‚  â”‚ (route=ask_more)    â”‚                                       â”‚  â”‚  â”‚     â”‚
â”‚  â”‚                     â”‚                                       â”‚  â”‚  â”‚     â”‚
â”‚  â”‚ è¾“å‡º:               â”‚                                       â”‚  â”‚  â”‚     â”‚
â”‚  â”‚  - follow_up_questions                                      â”‚  â”‚  â”‚     â”‚
â”‚  â”‚  - response_text â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚  â”‚     â”‚
â”‚           â”‚                                                       â”‚  â”‚     â”‚
â”‚           â–¼                                                       â”‚  â”‚     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚  â”‚     â”‚
â”‚  â”‚ recommend_build     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚     â”‚
â”‚  â”‚ (route=recommend)   â”‚                                             â”‚     â”‚
â”‚  â”‚                     â”‚                                             â”‚     â”‚
â”‚  â”‚ è¾“å‡º:               â”‚                                             â”‚     â”‚
â”‚  â”‚  - build â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  - estimated_power â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚  â”‚  â”‚
â”‚           â”‚                                                         â”‚  â”‚  â”‚
â”‚           â–¼                                                         â”‚  â”‚  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                            â”‚  â”‚  â”‚
â”‚  â”‚ validate_build      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                     â”‚                                               â”‚  â”‚
â”‚  â”‚ è¾“å‡º:               â”‚                                               â”‚  â”‚
â”‚  â”‚  - compatibility_issues â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                 â”‚
â”‚           â”‚                                                              â”‚
â”‚           â–¼                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                 â”‚
â”‚  â”‚ compose_reply       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”‚                     â”‚                                                    â”‚
â”‚  â”‚ è¾“å…¥:               â”‚                                                    â”‚
â”‚  â”‚  - route            â”‚                                                    â”‚
â”‚  â”‚  - response_text    â”‚                                                    â”‚
â”‚  â”‚  - build            â”‚                                                    â”‚
â”‚  â”‚  - compatibility_issues                                                  â”‚
â”‚  â”‚  - requirements     â”‚                                                    â”‚
â”‚  â”‚                     â”‚                                                    â”‚
â”‚  â”‚ è¾“å‡º:               â”‚                                                    â”‚
â”‚  â”‚  - response_text    â”‚ â”€â”€â–¶ ENDï¼ˆè¿”å›ç”¨æˆ·ï¼‰                                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                    â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.5 ä¸¤æ¡ä¸»è¦è·¯å¾„å¯¹æ¯”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           è·¯å¾„ Aï¼šè¿½é—®è·¯å¾„                                   â”‚
â”‚                         (route = "ask_more")                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   collect_requirements â”€â”€â–¶ generate_follow_up â”€â”€â–¶ compose_reply â”€â”€â–¶ END    â”‚
â”‚                                                                             â”‚
â”‚   ç‰¹ç‚¹ï¼š                                                                     â”‚
â”‚   - ä¸ç»è¿‡ recommend_build å’Œ validate_build                                â”‚
â”‚   - response_text ç”± generate_follow_up ç”Ÿæˆ                                â”‚
â”‚   - è¾“å‡ºè¿½é—®é—®é¢˜ï¼Œç­‰å¾…ç”¨æˆ·ä¸‹ä¸€è½®è¾“å…¥                                         â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           è·¯å¾„ Bï¼šæ¨èè·¯å¾„                                   â”‚
â”‚                        (route = "recommend")                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   collect_requirements â”€â”€â–¶ recommend_build â”€â”€â–¶ validate_build â”€â”€â–¶          â”‚
â”‚                                                          compose_reply â”€â”€â–¶ END â”‚
â”‚                                                                             â”‚
â”‚   ç‰¹ç‚¹ï¼š                                                                     â”‚
â”‚   - ç»è¿‡å®Œæ•´çš„æ¨èç”Ÿæˆå’Œå…¼å®¹æ€§éªŒè¯æµç¨‹                                       â”‚
â”‚   - response_text ç”± compose_reply ç”Ÿæˆ                                     â”‚
â”‚   - è¾“å‡ºå®Œæ•´é…ç½®æ–¹æ¡ˆï¼Œå¯¹è¯ç»“æŸ                                               â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸‰ã€å„èŠ‚ç‚¹è¯¦ç»†è¯´æ˜

### 3.1 collect_requirementsï¼ˆéœ€æ±‚æ”¶é›†èŠ‚ç‚¹ï¼‰

**èŒè´£**ï¼šè§£æç”¨æˆ·è¾“å…¥ï¼Œæå–ç»“æ„åŒ–éœ€æ±‚ï¼Œå†³å®šä¸‹ä¸€æ­¥è·¯ç”±ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    collect_requirements èŠ‚ç‚¹                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¾“å…¥ï¼š                                                           â”‚
â”‚   - user_input: ç”¨æˆ·æœ¬è½®è¾“å…¥æ–‡æœ¬                                  â”‚
â”‚   - requirements: å½“å‰å·²æ”¶é›†çš„éœ€æ±‚çŠ¶æ€                            â”‚
â”‚   - messages: å¯¹è¯å†å²                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¤„ç†æµç¨‹ï¼š                                                        â”‚
â”‚   1. è·å–æˆ–åˆå§‹åŒ– UserRequirements                               â”‚
â”‚   2. åˆ¤æ–­æ˜¯å¦ä½¿ç”¨ LLMï¼ˆå¤æ‚è¾“å…¥ç”¨ LLMï¼Œç®€å•è¾“å…¥ç”¨è§„åˆ™ï¼‰            â”‚
â”‚   3. è°ƒç”¨ extract_and_reply() æå–éœ€æ±‚å¹¶ç”Ÿæˆå›å¤                  â”‚
â”‚   4. åˆå¹¶éœ€æ±‚æ›´æ–°åˆ°å½“å‰çŠ¶æ€                                       â”‚
â”‚   5. å†³ç­–è·¯ç”±ï¼šask_more æˆ– recommend                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¾“å‡ºï¼š                                                           â”‚
â”‚   - requirements: æ›´æ–°åçš„éœ€æ±‚çŠ¶æ€                                â”‚
â”‚   - route: "ask_more" | "recommend"                              â”‚
â”‚   - response_text: å¦‚æœ route=ask_moreï¼ŒåŒ…å«è¿½é—®æ–‡æœ¬              â”‚
â”‚   - follow_up_questions: ç¼ºå¤±å­—æ®µåˆ—è¡¨ []                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è·¯ç”±å†³ç­–é€»è¾‘**ï¼š

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ LLM åˆ¤æ–­ should_continue â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                               â”‚
        should_continue=true           should_continue=false
              â”‚                               â”‚
              â–¼                               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ route=ask_more  â”‚             â”‚ route=recommend â”‚
    â”‚ ç»§ç»­è¿½é—®         â”‚             â”‚ è¿›å…¥æ¨èæµç¨‹     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**LLM should_continue åˆ¤æ–­è§„åˆ™**ï¼š
- ç”¨æˆ·è¯´"ä¸ç”¨äº†"ã€"å¤Ÿäº†"ã€"å°±è¿™æ ·" â†’ `false`
- ç”¨æˆ·è¯´"å¼€å§‹æ¨è"ã€"æ¨èå§"ã€"éšä¾¿" â†’ `false`
- å·²æ”¶é›†é¢„ç®—ã€ç”¨é€”ã€åˆ†è¾¨ç‡ä¸‰ä¸ªæ ¸å¿ƒä¿¡æ¯ â†’ å¯è®¾ä¸º `false`
- å¦åˆ™ â†’ `true`

---

### 3.2 generate_follow_upï¼ˆè¿½é—®ç”ŸæˆèŠ‚ç‚¹ï¼‰

**èŒè´£**ï¼šæ ¹æ®ç¼ºå¤±å­—æ®µç”Ÿæˆè¿½é—®å†…å®¹ï¼Œæ›´æ–° response_textã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    generate_follow_up èŠ‚ç‚¹                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¾“å…¥ï¼š                                                           â”‚
â”‚   - follow_up_questions: ç¼ºå¤±å­—æ®µåˆ—è¡¨                            â”‚
â”‚   - requirements: å½“å‰éœ€æ±‚çŠ¶æ€                                   â”‚
â”‚   - response_text: å·²æœ‰å›å¤æ–‡æœ¬ï¼ˆå¯èƒ½ä¸ºç©ºæˆ–å ä½ç¬¦ï¼‰               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¤„ç†æµç¨‹ï¼š                                                        â”‚
â”‚   1. è·å–ç¼ºå¤±å­—æ®µåˆ—è¡¨                                            â”‚
â”‚   2. å¦‚æœåˆ—è¡¨ä¸ºç©ºï¼Œæ ¹æ®éœ€æ±‚æ¨æ–­ç¼ºå¤±çš„å…³é”®ä¿¡æ¯ï¼š                    â”‚
â”‚      - æ— é¢„ç®— â†’ é—®é¢„ç®—                                           â”‚
â”‚      - æ— ç”¨é€” â†’ é—®ç”¨é€”                                           â”‚
â”‚      - æ— åˆ†è¾¨ç‡ â†’ é—®åˆ†è¾¨ç‡                                       â”‚
â”‚   3. æ£€æµ‹ response_text æ˜¯å¦ä¸ºæ— æ„ä¹‰å ä½ç¬¦                        â”‚
â”‚   4. å¦‚æœæ˜¯å ä½ç¬¦ï¼Œç”¨çœŸå®é—®é¢˜æ›¿æ¢                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¾“å‡ºï¼š                                                           â”‚
â”‚   - follow_up_questions: ç”Ÿæˆçš„è¿½é—®åˆ—è¡¨                          â”‚
â”‚   - response_text: æ›´æ–°åçš„è¿½é—®æ–‡æœ¬                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é—®é¢˜æ¨¡æ¿æ˜ å°„**ï¼š

| ç¼ºå¤±å­—æ®µ | è¿½é—®æ¨¡æ¿ |
|---------|---------|
| budget | ä½ çš„é¢„ç®—èŒƒå›´å¤§æ¦‚æ˜¯å¤šå°‘å‘€ï¼Ÿä¾‹å¦‚ 7000-9000 æˆ– 10000-12000ã€‚ |
| use_case | è¿™å°ç”µè„‘ä¸»è¦åšä»€ä¹ˆå‘¢ï¼Ÿæ¸¸æˆã€åŠå…¬ã€å‰ªè¾‘ï¼Œè¿˜æ˜¯ AI å¼€å‘ï¼Ÿ |
| resolution | ä½ ç›®æ ‡åˆ†è¾¨ç‡å’Œåˆ·æ–°ç‡æ˜¯å•¥ï¼Ÿæ¯”å¦‚ 1080p 144Hzã€2K 165Hzã€4K 60Hzã€‚ |
| cpu_preference | CPU ä½ æ›´åå‘ Intel è¿˜æ˜¯ AMDï¼Ÿæ²¡æœ‰åå¥½æˆ‘å°±æŒ‰æ€§ä»·æ¯”æ¥ã€‚ |
| storage | ä½ å¯¹å­˜å‚¨æœ‰è¦æ±‚å—ï¼Ÿæ¯”å¦‚è‡³å°‘ 1TBï¼Œæˆ–è€… 2TB æ›´ç¨³ã€‚ |
| noise | ä½ ä¼šåœ¨æ„é™éŸ³å—ï¼Ÿæ¯”å¦‚å¸Œæœ›é£æ‰‡å™ªéŸ³å°½é‡å°ã€‚ |

---

### 3.3 recommend_buildï¼ˆæ¨èç”ŸæˆèŠ‚ç‚¹ï¼‰

**èŒè´£**ï¼šæ ¹æ®éœ€æ±‚è°ƒç”¨å·¥å…·å‡½æ•°ï¼Œç”Ÿæˆå®Œæ•´çš„ç¡¬ä»¶é…ç½®ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    recommend_build èŠ‚ç‚¹                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¾“å…¥ï¼š                                                           â”‚
â”‚   - requirements: å®Œæ•´çš„éœ€æ±‚çŠ¶æ€                                  â”‚
â”‚   - tool_map: å·¥å…·å‡½æ•°æ˜ å°„è¡¨                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¤„ç†æµç¨‹ï¼š                                                        â”‚
â”‚   1. è°ƒç”¨ allocate_budget() åˆ†é…å„é…ä»¶é¢„ç®—                        â”‚
â”‚   2. æŒ‰ä¼˜å…ˆçº§è°ƒç”¨å„é…ä»¶æœç´¢å·¥å…·ï¼š                                 â”‚
â”‚      a. search_cpu() â†’ CPU å€™é€‰åˆ—è¡¨                              â”‚
â”‚      b. search_motherboard() â†’ ä¸»æ¿å€™é€‰åˆ—è¡¨                      â”‚
â”‚      c. search_memory() â†’ å†…å­˜å€™é€‰åˆ—è¡¨                           â”‚
â”‚      d. search_gpu() â†’ æ˜¾å¡å€™é€‰åˆ—è¡¨                              â”‚
â”‚      e. search_storage() â†’ å­˜å‚¨å€™é€‰åˆ—è¡¨                          â”‚
â”‚      f. search_psu() â†’ ç”µæºå€™é€‰åˆ—è¡¨                              â”‚
â”‚      g. search_case() â†’ æœºç®±å€™é€‰åˆ—è¡¨                             â”‚
â”‚      h. search_cooler() â†’ æ•£çƒ­å™¨å€™é€‰åˆ—è¡¨                         â”‚
â”‚   3. è°ƒç”¨ pick_build_from_candidates() é€‰æ‹©æœ€ä¼˜ç»„åˆ              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¾“å‡ºï¼š                                                           â”‚
â”‚   - build: BuildPlan é…ç½®æ–¹æ¡ˆ                                    â”‚
â”‚   - estimated_power: é¢„ä¼°åŠŸè€—                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é¢„ç®—åˆ†é…ç­–ç•¥**ï¼š

```
æ€»é¢„ç®— = requirements.budget_max

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    é¢„ç®—åˆ†é…æ¯”ä¾‹ï¼ˆæ¸¸æˆç”¨é€”ï¼‰                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é…ä»¶       â”‚ é¢„ç®—å æ¯”   â”‚ è¯´æ˜                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ GPU        â”‚ 40-50%     â”‚ æ¸¸æˆæ€§èƒ½æ ¸å¿ƒ                        â”‚
â”‚ CPU        â”‚ 15-20%     â”‚ å¤„ç†å™¨                              â”‚
â”‚ ä¸»æ¿       â”‚ 10-12%     â”‚ ä¸»æ¿                                â”‚
â”‚ å†…å­˜       â”‚ 8-10%      â”‚ å†…å­˜                                â”‚
â”‚ å­˜å‚¨       â”‚ 5-8%       â”‚ SSD                                 â”‚
â”‚ ç”µæº       â”‚ 5-7%       â”‚ ç”µæº                                â”‚
â”‚ æœºç®±       â”‚ 3-5%       â”‚ æœºç®±                                â”‚
â”‚ æ•£çƒ­å™¨     â”‚ 2-4%       â”‚ æ•£çƒ­                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 3.4 validate_buildï¼ˆå…¼å®¹æ€§éªŒè¯èŠ‚ç‚¹ï¼‰

**èŒè´£**ï¼šæ£€æŸ¥é…ç½®æ–¹æ¡ˆçš„å…¼å®¹æ€§é—®é¢˜ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    validate_build èŠ‚ç‚¹                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¾“å…¥ï¼š                                                           â”‚
â”‚   - build: BuildPlan é…ç½®æ–¹æ¡ˆ                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ£€æŸ¥é¡¹ç›®ï¼š                                                        â”‚
â”‚   1. CPU ä¸ä¸»æ¿æ’æ§½å…¼å®¹æ€§ï¼ˆsocket åŒ¹é…ï¼‰                         â”‚
â”‚   2. å†…å­˜ç±»å‹å…¼å®¹æ€§ï¼ˆDDR4/DDR5ï¼‰                                 â”‚
â”‚   3. GPU ä¸æœºç®±é•¿åº¦å…¼å®¹                                          â”‚
â”‚   4. æ•£çƒ­å™¨ä¸æœºç®±é«˜åº¦å…¼å®¹                                        â”‚
â”‚   5. ç”µæºåŠŸç‡ä½™é‡ï¼ˆå»ºè®® > å®é™…åŠŸè€— 20%ï¼‰                         â”‚
â”‚   6. ä¸»æ¿æ¿å‹ä¸æœºç®±å…¼å®¹                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¾“å‡ºï¼š                                                           â”‚
â”‚   - compatibility_issues: å…¼å®¹æ€§é—®é¢˜åˆ—è¡¨                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 3.5 compose_replyï¼ˆå›å¤ç»„è£…èŠ‚ç‚¹ï¼‰

**èŒè´£**ï¼šæ ¹æ®è·¯ç”±å’ŒçŠ¶æ€ç”Ÿæˆæœ€ç»ˆç”¨æˆ·å¯è§çš„å›å¤æ–‡æœ¬ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    compose_reply èŠ‚ç‚¹                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¾“å…¥ï¼š                                                           â”‚
â”‚   - route: å½“å‰è·¯ç”±çŠ¶æ€                                          â”‚
â”‚   - response_text: å·²æœ‰å›å¤æ–‡æœ¬                                  â”‚
â”‚   - build: é…ç½®æ–¹æ¡ˆï¼ˆå¯èƒ½ä¸ºç©ºï¼‰                                  â”‚
â”‚   - compatibility_issues: å…¼å®¹æ€§é—®é¢˜                             â”‚
â”‚   - requirements: éœ€æ±‚çŠ¶æ€                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¤„ç†é€»è¾‘ï¼š                                                        â”‚
â”‚   IF response_text å·²å­˜åœ¨ AND route != recommend:               â”‚
â”‚       â†’ ç›´æ¥è¿”å› response_textï¼ˆè¿½é—®åœºæ™¯ï¼‰                        â”‚
â”‚   ELIF route == recommend:                                       â”‚
â”‚       â†’ ç”Ÿæˆæ¨èå›å¤ï¼ˆåŒ…å«é…ç½®è¯¦æƒ… + å…¼å®¹æ€§æç¤ºï¼‰                  â”‚
â”‚   ELSE:                                                          â”‚
â”‚       â†’ è°ƒç”¨ LLM ç”Ÿæˆè¿½é—®å›å¤                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¾“å‡ºï¼š                                                           â”‚
â”‚   - response_text: æœ€ç»ˆç”¨æˆ·å¯è§çš„å›å¤æ–‡æœ¬                        â”‚
â”‚   - response_mode: "llm" | "fallback"                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å››ã€å®Œæ•´ä¼šè¯ç¤ºä¾‹

### ç¤ºä¾‹ï¼šç”¨æˆ·ä»å¼€åœºåˆ°æ¨èçš„å®Œæ•´æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬¬ 1 è½®                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç”¨æˆ·: æˆ‘æƒ³é…ä¸€å°ç”µè„‘                                                    â”‚
â”‚                                                                        â”‚
â”‚ collect_requirements:                                                  â”‚
â”‚   - æå–: æ— æ–°éœ€æ±‚                                                     â”‚
â”‚   - è·¯ç”±: ask_more                                                     â”‚
â”‚   - ç¼ºå¤±: [budget, use_case, resolution, ...]                          â”‚
â”‚                                                                        â”‚
â”‚ generate_follow_up:                                                    â”‚
â”‚   - é€‰æ‹©é—®é¢˜: budget                                                   â”‚
â”‚                                                                        â”‚
â”‚ ç³»ç»Ÿå›å¤: ä½ çš„é¢„ç®—èŒƒå›´å¤§æ¦‚æ˜¯å¤šå°‘å‘€ï¼Ÿä¾‹å¦‚ 7000-9000 æˆ– 10000-12000ã€‚     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬¬ 2 è½®                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç”¨æˆ·: 9000å·¦å³å§                                                        â”‚
â”‚                                                                        â”‚
â”‚ collect_requirements:                                                  â”‚
â”‚   - æå–: budget_min=9000, budget_max=9000                             â”‚
â”‚   - è·¯ç”±: ask_more                                                     â”‚
â”‚   - ç¼ºå¤±: [use_case, resolution, ...]                                  â”‚
â”‚                                                                        â”‚
â”‚ generate_follow_up:                                                    â”‚
â”‚   - é€‰æ‹©é—®é¢˜: use_case                                                 â”‚
â”‚                                                                        â”‚
â”‚ ç³»ç»Ÿå›å¤: å¥½çš„ï¼Œé¢„ç®—9000å…ƒå·²è®°å½•ã€‚è¿™å°ç”µè„‘ä¸»è¦åšä»€ä¹ˆå‘¢ï¼Ÿ                  â”‚
â”‚          æ¸¸æˆã€åŠå…¬ã€å‰ªè¾‘ï¼Œè¿˜æ˜¯ AI å¼€å‘ï¼Ÿ                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬¬ 3 è½®                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç”¨æˆ·: ä¸»è¦ç©æ¸¸æˆ                                                        â”‚
â”‚                                                                        â”‚
â”‚ collect_requirements:                                                  â”‚
â”‚   - æå–: use_case=["gaming"]                                          â”‚
â”‚   - è·¯ç”±: ask_more                                                     â”‚
â”‚   - ç¼ºå¤±: [resolution, ...]                                            â”‚
â”‚                                                                        â”‚
â”‚ generate_follow_up:                                                    â”‚
â”‚   - é€‰æ‹©é—®é¢˜: resolution                                               â”‚
â”‚                                                                        â”‚
â”‚ ç³»ç»Ÿå›å¤: æ˜ç™½äº†ï¼Œæ¸¸æˆç”¨é€”å·²è®°å½•ã€‚ä½ ç›®æ ‡åˆ†è¾¨ç‡å’Œåˆ·æ–°ç‡æ˜¯å•¥ï¼Ÿ              â”‚
â”‚          æ¯”å¦‚ 1080p 144Hzã€2K 165Hzã€4K 60Hzã€‚                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬¬ 4 è½®                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç”¨æˆ·: 2K 165Hz                                                          â”‚
â”‚                                                                        â”‚
â”‚ collect_requirements:                                                  â”‚
â”‚   - æå–: resolution="1440p"                                           â”‚
â”‚   - è·¯ç”±: recommend (ä¸‰ä¸ªæ ¸å¿ƒä¿¡æ¯å·²æ”¶é›†)                                â”‚
â”‚                                                                        â”‚
â”‚ recommend_build:                                                       â”‚
â”‚   - é¢„ç®—åˆ†é…: GPU 40%, CPU 18%, ä¸»æ¿ 12%...                            â”‚
â”‚   - é…ä»¶æœç´¢: è°ƒç”¨å„ search_* å·¥å…·                                     â”‚
â”‚   - æœ€ä¼˜ç»„åˆ: pick_build_from_candidates()                             â”‚
â”‚                                                                        â”‚
â”‚ validate_build:                                                        â”‚
â”‚   - æ£€æŸ¥å…¼å®¹æ€§: æ— é—®é¢˜                                                 â”‚
â”‚                                                                        â”‚
â”‚ compose_reply:                                                         â”‚
â”‚   - ç”Ÿæˆæ¨èå›å¤                                                       â”‚
â”‚                                                                        â”‚
â”‚ ç³»ç»Ÿå›å¤: å¥½çš„ï¼Œæ ¹æ®æ‚¨çš„éœ€æ±‚ï¼Œæˆ‘ä¸ºæ‚¨æ¨èä»¥ä¸‹é…ç½®ï¼š                       â”‚
â”‚                                                                        â”‚
â”‚          ğŸ–¥ï¸ CPU: AMD Ryzen 5 7500F - Â¥1099                             â”‚
â”‚          ğŸ”§ ä¸»æ¿: MSI B650 GAMING PLUS WIFI - Â¥1199                     â”‚
â”‚          ğŸ’¾ å†…å­˜: Kingston FURY 32GB DDR5-6000 - Â¥699                  â”‚
â”‚          ğŸ® æ˜¾å¡: AMD RX 6750 GRE 12GB - Â¥2199                         â”‚
â”‚          ğŸ’¿ å­˜å‚¨: Samsung 980 PRO 1TB - Â¥599                           â”‚
â”‚          âš¡ ç”µæº: Corsair RM650 - Â¥599                                 â”‚
â”‚          ğŸ“¦ æœºç®±: Phanteks G360A - Â¥399                                â”‚
â”‚          â„ï¸ æ•£çƒ­: Thermalright PA120 - Â¥199                            â”‚
â”‚                                                                        â”‚
â”‚          ğŸ’° æ€»ä»·: Â¥8992                                                â”‚
â”‚          âš¡ é¢„ä¼°åŠŸè€—: 450W                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äº”ã€å…³é”®æ•°æ®ç»“æ„

### 5.1 GraphStateï¼ˆå·¥ä½œæµçŠ¶æ€ï¼‰

```python
class GraphState(TypedDict):
    messages: List[BaseMessage]      # å¯¹è¯å†å²
    user_input: str                   # ç”¨æˆ·æœ¬è½®è¾“å…¥
    requirements: UserRequirements    # éœ€æ±‚çŠ¶æ€
    follow_up_questions: List[str]    # ç¼ºå¤±å­—æ®µåˆ—è¡¨
    build: BuildPlan                  # æ¨èé…ç½®
    compatibility_issues: List[str]   # å…¼å®¹æ€§é—®é¢˜
    estimated_power: int              # é¢„ä¼°åŠŸè€—
    route: Literal["ask_more", "recommend"]  # è·¯ç”±çŠ¶æ€
    response_text: str                # å›å¤æ–‡æœ¬
```

### 5.2 UserRequirementsï¼ˆç”¨æˆ·éœ€æ±‚ï¼‰

```python
class UserRequirements(BaseModel):
    budget_min: Optional[int] = None
    budget_max: Optional[int] = None
    budget_set: bool = False          # æ˜¯å¦å·²è®¾ç½®é¢„ç®—
    
    use_case: List[str] = []          # gaming, office, video_editing, ai
    use_case_set: bool = False
    
    resolution: Optional[str] = None  # 1080p, 1440p, 4k
    resolution_set: bool = False
    
    cpu_preference: Optional[str] = None  # Intel, AMD
    prefer_brands: List[str] = []
    
    storage_min: Optional[int] = None     # æœ€å°å­˜å‚¨å®¹é‡ (GB)
    noise: Optional[bool] = None          # æ˜¯å¦éœ€è¦é™éŸ³
    include_monitor: bool = False
```

### 5.3 BuildPlanï¼ˆé…ç½®æ–¹æ¡ˆï¼‰

```python
class BuildPlan(BaseModel):
    cpu: Optional[Part] = None
    motherboard: Optional[Part] = None
    memory: Optional[Part] = None
    gpu: Optional[Part] = None
    storage: Optional[Part] = None
    psu: Optional[Part] = None
    case: Optional[Part] = None
    cooler: Optional[Part] = None
    
    def total_price(self) -> int:
        """è®¡ç®—æ€»ä»·"""
        return sum(p.price for p in [self.cpu, self.motherboard, ...] if p)
```

---

## å…­ã€LLM ä¸è§„åˆ™æ¨¡å¼åˆ‡æ¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    LLM å¯ç”¨æ€§æ£€æŸ¥                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   æ£€æŸ¥ç¯å¢ƒå˜é‡: OPENROUTER_API_KEY / ZHIPU_API_KEY / OPENAI_API_KEY â”‚
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚   â”‚ API Key å­˜åœ¨  â”‚â”€â”€Yesâ”€â”€â–¶â”‚ ä½¿ç”¨ LLM æ¨¡å¼ â”‚                      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚          â”‚                                                      â”‚
â”‚          No                                                     â”‚
â”‚          â”‚                                                      â”‚
â”‚          â–¼                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                             â”‚
â”‚   â”‚ è§„åˆ™æ¨¡å¼å…œåº•   â”‚                                             â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                             â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**LLM æ¨¡å¼**ï¼š
- ä½¿ç”¨ `_runtime_llm()` æ„å»ºæ¨¡å‹å®ä¾‹
- è°ƒç”¨ `extract_and_reply()` è¿›è¡Œç»“æ„åŒ–æå–
- æ”¯æŒæ™ºè°± GLMã€OpenRouterã€OpenAI ä¸‰ç§æä¾›å•†

**è§„åˆ™æ¨¡å¼**ï¼š
- ä½¿ç”¨ `_extract_with_rules()` æ­£åˆ™åŒ¹é…
- å…³é”®è¯è§¦å‘ï¼šé¢„ç®—ã€ç”¨é€”ã€åˆ†è¾¨ç‡ç­‰
- å›å¤æ¨¡æ¿ï¼š`_generate_fallback_reply()`

---

## ä¸ƒã€é”™è¯¯å¤„ç†ä¸é™çº§

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        é”™è¯¯å¤„ç†é“¾                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   LLM è°ƒç”¨å¤±è´¥                                                   â”‚
â”‚        â”‚                                                        â”‚
â”‚        â–¼                                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚   â”‚ try: LLM æå–                       â”‚                      â”‚
â”‚   â”‚ except Exception:                   â”‚                      â”‚
â”‚   â”‚     update = _extract_with_rules()  # è§„åˆ™æå–             â”‚
â”‚   â”‚     reply = _generate_fallback_reply()  # æ¨¡æ¿å›å¤         â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                                                                 â”‚
â”‚   æ¨èç”Ÿæˆå¤±è´¥                                                   â”‚
â”‚        â”‚                                                        â”‚
â”‚        â–¼                                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚   â”‚ IF build ä¸ºç©º:                      â”‚                      â”‚
â”‚   â”‚     è¿”å›é”™è¯¯æç¤º + å»ºè®®è”ç³»æ”¯æŒ      â”‚                      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å…«ã€æ€§èƒ½è¿½è¸ª

æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰æ€§èƒ½è¿½è¸ªï¼š

```python
tracker.start("node_name")
# ... èŠ‚ç‚¹å¤„ç†é€»è¾‘ ...
tracker.end()

# è¾“å‡ºç¤ºä¾‹:
# [PERF] collect_requirements took 1.234s
# [PERF] generate_follow_up took 0.001s
# [PERF] recommend_build took 2.345s
# [PERF] validate_build took 0.050s
# [PERF] compose_reply took 0.500s
```
